<div class="property-page">
<center><h2><a href="<%= property_url(@property) %>"><%= @property.address %> <%= @property.floor %> Floor</a></h2>

<% @properties.each do |property| %>
  <% if property == @property %>
    <% class_str = "btn btn-default current-button" %>
  <% else %>
    <% class_str = "btn btn-default" %>
  <% end %> 
  <%= link_to "#{property.address} #{property.floor} Floor", dashboard_url(property), class: class_str %>
<% end %></center>

<br><br>


<div class="diagram">
<form action="<%= property_url(@property) %>" method="post">
  <input
    name="_method"
    type="hidden"
    value="put">
  <input
    name="authenticity_token"
    type="hidden"
    value="<%= form_authenticity_token %>">

<div class="top-box">
  <div class="purchase-price2">

    <label for="property_purchase_price">Purchase Price</label><br>
    &#36; <input
      id="property_purchase_price"
      name="property[purchase_price]"
      type="number"
      step="1"
      value="<%= @property.purchase_price.to_i %>"><br><br>

  </div>
  <div class="loan-amount2">

    <label for="property_loan_amount">Loan Amount</label><br>
    &#36; <input
      id="property_loan_amount"
      name="property[loan_amount]"
      type="number"
      step="1"
      value="<%= @property.loan_amount.to_i %>"><br><br>

  </div>
  <div class="interest-rate2">

    <label for="property_interest_rate">Interest Rate</label><br>
    <input
      id="property_interest_rate"
      name="property[interest_rate]"
      type="number"
      step="0.01"
      value="<%= @property.interest_rate %>"> &#37;<br><br>

  </div>
  <div class="interest-only2">

    <label for="property_interest_only">Interest Only</label><br>
    <input type="radio" name="property[interest_only]" value="Yes" <%= "checked" if @property.interest_only %>> Yes&nbsp;&nbsp;&nbsp;
    <input type="radio" name="property[interest_only]" value="No" <%= "checked" unless @property.interest_only %>> No

  </div>
  <div class="amortization2">

    <label for="property_amortization">Amortization</label><br>
    <input
      id="property_amortization"
      name="property[amortization]"
      type="number"
      value="<%= @property.amortization %>"> yrs<br><br>

  </div>

</div>
<div class="top-box">
  <div class="income2">

    <label for="property_income">Income</label><br>
    &#36; <input
      id="property_income"
      name="property[income]"
      type="number"
      step="1"
      value="<%= @property.income.to_i %>"><br><br>

  </div>
  <div class="expenses2">

    <label for="property_expenses">Expenses</label><br>
    &#36; <input
      id="property_expenses"
      name="property[expenses]"
      type="number"
      step="1"
      value="<%= @property.expenses.to_i %>"><br><br>

  </div>

  <div class="submit-button">
    <input type="submit" id="pos-neg-submit" value="Update" class="btn btn-default">
  </div>
</div>

</form>
<br><br>

<div class="top-box">
  <div class="inner">Investment @ <%= @property.cap_rate %>% Cap Rate</div>
  <div class="investment-top">&#36;<%= @property.purchase_price.to_i %></div>
</div>
<div class="top-box">
  <div class="inner4">Leveraged (Borrowing) vs. Unleveraged</div>
  <div class="middle2"></div>
  <div class="left">&#36;<%= @property.loan_amount.to_i %> &#64;<br><font color="black"><%= @property.interest_rate %>&#37;</font> Interest</div>
  <div class="right">Borrow <br>Nothing</div>
</div>
<div class="top-box">
  <div class="inner">Net Operating <br>Income</div>
  <div class="investmentb"></div>
  <div class="left2">&#36;<%= @property.net_operating_income.to_i %></div>
  <div class="right2">&#36;<%= @property.net_operating_income.to_i %></div>
</div>
<div class="top-box">
  <div class="inner">Debt Service <br>Payments</div>
  <div class="investmentb"></div>
  <div class="left2">&#36;<%= @property.debt_service.to_i %></div>
  <div class="right2">$0</div>
</div>
<div class="top-box">
  <div class="inner2">Cash Flow</div>
  <div class="investment2b"></div>
  <div class="left3">&#36;<%= @property.cash_flow.to_i %></div>
  <div class="right3">&#36;<%= @property.net_operating_income.to_i %></div>
</div>
<div class="top-box">
  <div class="inner3">Cash on Cash <br>(Income Earned / <br>Initial Investment)</div>
  <div class="middle-result2"></div>
  <div class="left-result"><%= @property.cash_on_cash %>&#37;</div>
  <div class="right-result"><%= @property.cap_rate %>&#37;</div>
</div>
<div class="flow"></div>
<div class="flow2b"></div>


</div>


<br><br><br>

<form action="<%= property_url(@property) %>" method="post">
  <input
     name="_method"
     type="hidden"
     value="put">
  <input
     name="authenticity_token"
     type="hidden"
     value="<%= form_authenticity_token %>">

<center><table class="table table-striped table-bordered table-condensed dashboard-table">
  <tr>
    <td class="left-column"><b>Income:</b></td>
    <td class="right-column">&#36;
      <input
        id="property_income"
        name="property[income]"
        type="number"
        value="<%= @property.income %>">
    </td>
  </tr>
  <tr>
    <td><b>Expenses:</b></td>
    <td class="right-column">&#36;
      <input
        id="property_expenses"
        name="property[expenses]"
        type="number"
        value="<%= @property.expenses %>">
    </td>
  </tr>
  <tr>
    <td><b>Net Operating Income (NOI):</b></td>
    <td class="right-column">&#36; <%= @property.net_operating_income %></td>
  </tr>
  <tr>
    <td><b>Debt Service:</b></td>
    <td class="right-column">&#36; <%= @property.debt_service %></td>
  </tr>
  <tr>
    <td><b>Cash Flow:</b></td>
    <td class="right-column">&#36; <%= @property.cash_flow %></td>
  </tr>
  <tr>
    <td><b>Debt Service Coverage Ratio (DSCR):</b></td>
    <td class="right-column"><%= @property.dscr %></td>
  </tr>
  <tr>
    <td><b>Cash on Cash:</b></td>
    <td class="right-column"><%= @property.cash_on_cash %> &#37;</td>
  </tr>
  <tr>
    <td><b>Capitalization Rate (Cap Rate):</b></td>
    <td class="right-column"><%= @property.cap_rate %> &#37;</td>
  </tr>
</table>

<table class="table table-striped table-bordered table-condensed dashboard-table">
  <tr>
    <td class="left-column"><b>Purchase Price:</b></td>
    <td class="right-column">&#36;
      <input
        id="property_purchase_price"
        name="property[purchase_price]"
        type="number"
        value="<%= @property.purchase_price %>">
    </td>
  </tr>
  <tr>
    <td><b>Loan to value (LTV &#37;):</b></td>
    <td class="right-column"><%= @property.loan_to_value %> &#37;</td>
  </tr>
  <tr>
    <td><b>Interest Rate (&#37;):</b></td>
    <td class="right-column">
      <input
        id="property_interest_rate"
        name="property[interest_rate]"
        type="number"
        step="0.01"
        value="<%= @property.interest_rate %>"> &#37;
    </td>
  </tr>
  <tr>
    <td><b>Amortization (yrs):</b></td>
    <td class="right-column">
      <input
        id="property_amortization"
        name="property[amortization]"
        type="number"
        value="<%= @property.amortization %>"> yrs
    </td>
  </tr>
  <tr>
    <td><b>Interest Only:</b></td>
    <td class="right-column">
      <input type="radio" name="property[interest_only]" value="Yes" <%= "checked" if @property.interest_only %>> Yes&nbsp;&nbsp;&nbsp;
      <input type="radio" name="property[interest_only]" value="No" <%= "checked" unless @property.interest_only %>> No
    </td>
  </tr>
  <tr>
    <td><b>Loan Amount:</b></td>
    <td class="right-column">&#36;
      <input
        id="property_loan_amount"
        name="property[loan_amount]"
        type="number"
        value="<%= @property.loan_amount %>">
    </td>
  </tr>
  <tr>
    <td><b>Down Payment:</b></td>
    <td class="right-column">&#36; <%= @property.down_payment %></td>
  </tr>
</table>

<a href="/equations.txt">Link to equations</a><br><br>

  <input type="submit" value="Update" class="btn btn-default">
</form>


</center>






<h3>Page Views</h3>
(does not count logged in user on own properties)

<% data = @property.views.group_by_day(:created_at).count %>
<% new_data = {} %>
<% data.each { |key, value| new_data[key.to_date] = value } %>

<%= line_chart(new_data, discrete: true) %>

<h3>Showings</h3>

<% data = @property.showings.group_by_day(:created_at).count %>
<% new_data = {} %>
<% data.each { |key, value| new_data[key.to_date] = value } %>

<%= line_chart(new_data, discrete: true) %>

<br>
<div class="group">
  <% @property.showings.each do |showing| %>
    <div class="showing"> 
      <%= showing.name %><br>
      <%= showing.title %><br>
      <%= showing.email %><br>
      <%= showing.company %><br>
      <%= showing.phone %><br>
    </div>
  <% end %>
</div>


</div>

<br><br><br><br>




